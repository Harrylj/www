<!DOCTYPE html>
<html>

<head lang="en">
	<meta charset="UTF-8">
	<!-- 使用最新的ie内核渲染 -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- 移动设备优先, 禁止缩放 -->
	<meta name="viewport"
		content="width=device-width, initial-scale=1,minimum-scale=1,maximum-scale=1, user-scalable=no">
	<!-- 国产浏览器(360)使用webkit内核 -->
	<meta name="renderer" content="webkit">
	<!-- 禁止识别为手机号码 -->
	<meta name="format-detection" content="telephone=no" />
	<meta name="keywords" content="">
	<meta name="description" content="">
	<link rel="stylesheet" href="css/vant.css" />
	<link rel="stylesheet" type="text/css" href="css/public.css" />
	<link rel="stylesheet" type="text/css" href="css/index.css" />
	<title>投票活动</title>
	<style type="text/css">
		.xwxq{
			position: relative;
		}
		#app{
			padding-top: 0;
			background-color:#12206A
		}
		.public-header-title{
			background-color: transparent;
		}
		.phtc-fenxiang{
			right: 0;
		}
		.zqsl-item,
		.wzwb-flhd-div,
		.mflj-item{
			background-color: #263377;
		}
		.xwxq *{
			color: white;
		}
		.zqxq-body{
			position: relative;
			padding: 0 0 .4rem 0;
			/* background-color: rgba(255, 255, 255, .08);
			border-radius: .67rem .67rem 0 0; */
		}
		
		.zqxq-body{
			position: relative;
			border-top: 1px solid rgba(255, 255, 255, .2);
		}
		.zqxq-body h2{
			margin-bottom: .2rem;
		}
		.zqxq-body h3{
			font-size: .31rem;
			line-height: .6rem;
		}
		.zqxq-list{
			display: flex;
			justify-content: space-between;
			flex-wrap: wrap;
		}
		.zqxq-item{
			width: 3.3rem;
			margin-bottom: .2rem;
		}
		.zqxq-item img{
			display: block;
			height: 2.5rem;
			width: 100%;
			margin-bottom: .2rem;
		}
		.zqxq-item p{
			font-size: .28rem;
			line-height: .6rem;
			opacity: .6;
		}
		.tphd-content{
			height: 85%;
			overflow-y: scroll;
			padding: .3rem;
		}
		.tphd-content p{
			line-height: .6rem;
			font-size: .28rem;
		}
		.mflj-item{
			position: relative;
			padding-left: 2.7rem;
			min-height: 2.5rem;
			margin-bottom: .2rem;
			padding-top: .2rem;
		}
		.mflj-item:last-child{
			margin-bottom: 0;
		}
		.flhd-tphd-div{
			position: relative;
			display: flex;
			justify-content: space-between;
			flex-wrap: wrap;
		}
		.flhd-tphd-item{
			position: relative;
			border-radius: .2rem;
			overflow: hidden;
			margin-bottom: .2rem;
		}
		.flhd-tphd-item>img,
		.flhd-tphd-item .van-image{
			display: block;
			width: 3.3rem;
			height: 3.8rem;
		}
		.flhd-tphd-item-index{
			position: absolute;
			left: 0;
			top: .2rem;
			line-height: .5rem;
			padding: 0 .25rem;
			font-size: .27rem;
			border-radius: 0 .07rem .07rem 0;
			background-color: rgba(10, 10, 10, 0.58);
		}
		.flhd-tphd-item .flhd-tphd-content{
			position: absolute;
			bottom: .7rem;
			left: 0;
			width: 100%;
			padding-top: .3rem;
			padding-bottom: .1rem;
			background: linear-gradient(0deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0));
		}
		.flhd-tphd-item h3{
			text-align: center;
			font-size: .31rem;
			line-height: .5rem;
			padding:  0 .1rem;
		}
		.flhd-tphd-item p{
			font-size: .28rem;
			opacity: .58;
			text-align: center;
			line-height: .5rem;
		}
		.flhd-tphd-item-footer{
			display: flex;
			flex: 1;
		}
		.tphd-btn-lp,
		.tphd-btn-tp{
			width: 100%;
			text-align: center;
			line-height: .7rem;
			font-size: .31rem;
		}
		.tphd-btn-lp{
			background-color: #3F4A86;
		}
		.tphd-btn-tp{
			background: #009BFE;
		}
		.index-swipe-01{
			position: relative;
			height: 4.006rem;
		}
		.index-swipe-01 .van-image{
			position: relative;
			height: 100%;
			width: 100%;
		}
		.index-swipe-01 img {
			height: 100%;
			width: 100%;
		}
		.index-swipe-01 .van-swipe__indicator{
			width: .08rem;
			height: .06rem;
			background-color: #91ACE1;
		}
		.index-swipe-01 .van-swipe__indicator--active{
			width: .12rem;
			background-color: #FFFFFF;
		}
		.tphd-hdgz{
			position: absolute;
			right: 0;
			top: 50%;
			margin-top: -.25rem;
			background-color: #94A4C6;
			font-size: .27rem;
			height: .5rem;
			border-radius: .26rem 0 0 .26rem;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 0 .2rem;
		}
		.tphd-hdgz .van-icon{
			margin-right: .1rem;
		}
		.van-tabs__nav{
			background-color: transparent;
			padding: 0 1.5rem;
		}
		.van-tab.van-tab--active{
			opacity: 1;
		}
		.van-tab{
			opacity: .6;
		}
		.van-tabs__line{
			background-color: transparent;
		}
		.van-tab__text{
			font-size: .35rem;
		}
		.van-tabs--line .van-tabs__wrap{
			height: 1.2rem;
		}
		.tphd-btn-sczp{
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			line-height: 1.2rem;
			text-align: center;
			font-size: .31rem;
			font-weight: bold;
			/* background-color: #28356F; */
			/* background-color: rgba(255, 255, 255, .1); */
			background-color: #009BFE;
			letter-spacing: .04rem;
		}
		div.zqsl-popup{
			padding-bottom: 0;
		}
		.zqsl-btn-footer{
			flex-direction: column;
			height: 15%;
		}
		.zqsl-btn-footer .zqsl-sx-item{
			border-radius: .4rem;
			margin: 0 auto;
		}
	</style>
</head>

<body>
	<div class="tphd xwxq flhd" id="app" v-cloak>
		<div class="public-header-title">
			<div class="public-header-title-content">
				<div class="phtc-return" @click="public_return_page()"></div>
				<div class="tphd-hdgz" @click="activityRule()"><van-icon name="warning-o"></van-icon>活动规则</div>
				<!-- <div class="phtc-title">投票活动</div> -->
				
			</div>
		</div>
		<div class="index-header-swipe">
			<van-swipe class="index-swipe-01" :autoplay="3000" >
				<van-swipe-item>
					<!-- <img v-lazy="FLHD.imageUrl" alt=""> -->
					<van-image fit="cover" lazy-load :src="FLHD.imageUrl">
						<template v-slot:error>加载失败</template>
					</van-image>
				</van-swipe-item>
			</van-swipe>
		</div>
		<van-popup class="zqsl-popup" v-model="show" position="right" :style="{ height: '100%',width:'86.6%' }">
			<div class="tphd-content" v-html="FLHD.content"></div>
			<div class="zqsl-sx-list zqsl-btn-footer">
				<div class="zqsl-sx-item zqsl-sx-item-click" @click="selectQD()">确定</div>
			</div>
		</van-popup>
		<van-pull-refresh v-model="refreshing" @refresh="onRefresh">
		<van-list v-model="loading" finished-text="没有更多了" :finished="finished" @load="onLoad">
		<div class="zqxq-body">
			<van-tabs v-model="active"  @click="toggleList">
				<!-- <van-tab title="人气展品">
					<div class="index-ygz flhd-tphd">
						<div class="flhd-tphd-div">
							<div class="flhd-tphd-item" @click="goPage('article_tphd.html',{'id':item.id})" v-for="(item,index) in list_content" :key="index">
								<van-image fit="cover" lazy-load :src="item.imageUrl">
									<template v-slot:error>加载失败</template>
								</van-image>
								<div v-show="item.code?true:false" class="flhd-tphd-item-index">{{item.code}}号</div>
								<div class="flhd-tphd-content">
									<h3 class="van-ellipsis">{{item.title}}</h3>
									<p>{{item.voteCount}}票</p>
								</div>
								<div class="flhd-tphd-item-footer">
									<div class="tphd-btn-tp" @click.stop="toupiao(item)">投票</div>
								</div>
							</div>
						</div>
					</div>
				</van-tab> -->
				<van-tab title="人气设计">
					<div class="index-ygz flhd-tphd">
						<div class="flhd-tphd-div">
							<div class="flhd-tphd-item" @click="goPage('article_tphd2.html',{'id':item.id})" v-for="(item,index) in list_content" :key="index">
								<!-- <img src="images/bg.png" alt=""> -->
								<van-image fit="cover" lazy-load :src="item.imageUrl">
									<template v-slot:error>加载失败</template>
								</van-image>
								<div v-show="item.code?true:false" class="flhd-tphd-item-index">{{item.code}}号</div>
								<div class="flhd-tphd-content">
									<h3 class="van-ellipsis">{{item.title}}</h3>
									<!-- <p>{{item.voteCount?item.voteCount:0}}票</p> -->
									<p>{{item.voteCount}}票</p>
								</div>
								<div class="flhd-tphd-item-footer">
									<!-- <div class="tphd-btn-lp">拉票</div> -->
									<div class="tphd-btn-tp" @click.stop="toupiao(item)">投票</div>
								</div>
							</div>
						</div>
					</div>
				</van-tab>
			</van-tabs>
		</div>
		</van-list>
		</van-pull-refresh>
		<!-- <a href="single_sczp.html"><div class="tphd-btn-sczp">上传作品</div></a> -->
	</div>
	<script>

	</script>
	<script src="js/jquery-2.1.3.min.js"></script>
	<script src="js/public.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/axios.min.js"></script>
	<script src="js/axios_my.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/vant.min.js"></script>

	<script type="text/javascript">
		$(function(){
			navHeader();
			$(window).scroll(function () {
				navHeader();
			})
		})
		// 自动注册 Lazyload 组件,可以配置额外的选项
		Vue.use(vant.Lazyload, {
			lazyComponent: true
		});
		var _obj = public_obj();
		 
		var app = new Vue({
			el: '#app',
			data: {
				show: false,
				value: 2,
				active: 3,
				show: false,
				swipeImages: [
					'https://img.yzcdn.cn/vant/apple-1.jpg',
					// 'https://img.yzcdn.cn/vant/apple-2.jpg',
				],
				FLHD:'', // 福利活动-投票活动
				list_content:[], // 内容列表
				index:1,
				loading: false,		// 开启加载
				finished: false,	// 结束加载
				refreshing: false,  // 下拉刷新
				pageNum: 10,
			},
			created: function () {
				var _this = this;
				// vant.Toast('提示看看');
				// 福利活动
				axios.get('api/v1/channels/'+_obj.idSite+'/'+_obj.idTPHD2)
				.then(function (response) {
						_this.FLHD = response.data;
						public_imgsrc([_this.FLHD])
						console.log('9999922311',_this.FLHD)
				})
				// // 获取投票数据
				// this.getData();
			},
			mounted: function () {

			},
			methods: {
				// 加载事件
				onLoad() {
					var _this = this;
					setTimeout(() => {
						if (_this.refreshing) {
							_this.list_content = [];
							_this.refreshing = false;
							_this.index = 1;
						}
						// 获取投票数据
						_this.getData()
						// _this.onLoad()
					},10);
					console.log('下拉')
				},
				onRefresh() {
					// 清空列表数据
					this.finished = false;
					// 重新加载数据
					// 将 loading 设置为 true，表示处于加载状态
					this.loading = true;
					this.onLoad();
				},
				// 投票
				toupiao(_item){
					axios.post(_obj.shopUrl+'api/services/app/SiteServer/IncrementVote', {
					"siteId": _obj.idSite_PC,
					"channelId": _obj.idTPHD2_PC,
					"contentId": _item.id,
					})
					.then(function (response) {
						// _this.YGZ = response.data.contents;
						// public_imgsrc(_this.YGZ)
						vant.Toast('投票成功')
						_item.voteCount = _item.voteCount+1;
						console.log(response.data)
					})
					.catch(function (error) {
						// console.log(error)
						vant.Toast('您已投过票了，明天再来吧！')
						// vant.Toast(error)
					});
					// _item.voteCount = _item.voteCount+1;
					console.log(_item)
				},
				showPopup() {
					this.show = true;
				},
				hidePopup() {
					this.show = false;
				},
				selectQD(){
					this.hidePopup();
				},
				// 切换最新热门
				toggleList(name,title){
					console.log(name,title)
					// 获取投票数据
					this.getData(name);
				},
				// 获取投票数据
				getData(_index){
					var _this = this;
					var _name = 'hits';
						_type = true;
					// if(_index == 0){ // 最新
					// 	_name = 'createdDate';
					// 	_type = false;
					// }
					// else if(_index == 1){ // 热门
					// 	_name = 'voteCount';
					// 	_type = true;
					// }
					axios.post('api/v1/contents', {
						siteId: _obj.idSite_PC,
						channelId: _obj.idTPHD2_PC,
						wheres:[ {
							"column": "checked",
							"operator": "=",
							"value": "1"
						}],
						orders:[{
							column: _name,  // 最新createdDate  热门voteCount
							desc: _type
						}],
						page: _this.index,
						perPage:_this.pageNum,
					})
					.then(function (response) {
						// _this.list_content = response.data.contents;
						var aaa  = public_imgsrc_pc(response.data.contents);
						aaa.forEach((element,index) => {
							element.voteCount?element.voteCount=element.voteCount:element.voteCount=0;
							_this.list_content.push(element)
							
						});
						_this.index = _this.index + 1;
						// 加载完成
						_this.loading = false;
						if(response.data.contents.length < _this.pageNum){
							_this.finished = true;
						}
						console.log('9999922311',_this.list_content)
					})
				},
				activityRule(){
					// vant.Toast('活动规则')
					this.showPopup()
				},
				fenxiang() {
					vant.Toast('分享')
				},
				showPopup() {
					this.show = true;
				},
				hidePopup() {
					this.show = false;
				},
				onClickLeft() {
					vant.Toast('返回');
				},
				onClickRight() {
					vant.Toast('按钮');
				},
				selectMulu(_index) {
					this.active = _index;
					vant.Toast(this.active)
					this.hidePopup()
				}
			},

		})
	</script>
</body>

</html>