<!DOCTYPE html>
<html>

<head lang="en">
	<meta charset="UTF-8">
	<!-- 使用最新的ie内核渲染 -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- 移动设备优先, 禁止缩放 -->
	<meta name="viewport"
		content="width=device-width, initial-scale=1,minimum-scale=1,maximum-scale=1, user-scalable=no">
	<!-- 国产浏览器(360)使用webkit内核 -->
	<meta name="renderer" content="webkit">
	<!-- 禁止识别为手机号码 -->
	<meta name="format-detection" content="telephone=no" />
	<meta name="keywords" content="">
	<meta name="description" content="">
	<link rel="stylesheet" href="css/vant.css" />
	<link rel="stylesheet" type="text/css" href="css/public.css" />
	<link rel="stylesheet" type="text/css" href="css/index.css" />
	<title>上传作品</title>
	<style type="text/css">
		.xwxq{
			position: relative;
		}
		#app{
			padding-top: 1rem;
			padding-bottom: 0;
			background-color: #1A285C;
		}
		.public-header-title{
			background-color: transparent;
		}
		.phtc-fenxiang{
			right: 0;
		}
		.xwxq-body{
			position: relative;
			padding: 0 .3rem 0 .3rem;
			border-radius: .67rem .67rem 0 0;
		}
		.sxzp-body{
			position: relative;
		}
		#app *{
			color: white;
		}
		.van-cell{
			padding: .1rem 0;
			background-color: transparent;
		}
		.van-cell::after{
			left: 0;
			right: 0;
			border-bottom: 1px solid rgba(247, 245, 245, 0.2);
		}
		.sczp-zpms
		,.sczp-zpt{
			padding: .1rem 0 .35rem 0;
			flex-direction: column;
		}
		.sczp-zpms .van-field__body{
			background-color: rgba(255, 255, 255, .08);
		}
		.van-cell__title span{
			font-size: .31rem;
			line-height: .8rem;
		}
		.van-field__body input{
			font-size: .31rem;
			line-height: .8rem;
		}
		.van-field__error-message{
			font-size: .24rem;
			line-height: .5rem;
		}
		.sczp-zpms textarea{
			padding: .3rem;
			height: 2.4rem!important;
			line-height: .6rem;
			font-size: .31rem;
		}
		.sczp-zpt.van-cell::after{
			border: none;
		}
		.sczp-zpt .van-uploader{
			margin-top: .3rem;
		}
		.van-uploader__preview-image
		,.van-uploader__upload{
			width: 2.15rem;
			height: 2.15rem;
		}
		.van-uploader__preview{
			margin: 0 .2rem .2rem 0;
		}
		.van-uploader__preview:nth-child(3n)
		,.van-uploader__upload{
			margin-right: 0;
		}
		.van-uploader__upload{
			background-image: url(images/icon-shangchuan.png);
			background-size: 100% 100%;
			background-repeat: no-repeat;
			background-color: transparent;
		}
		.van-uploader__upload .van-icon
		,.van-icon-photograph::before{
			color: transparent;
		}
		.sczp-zpt .van-field__label{
			width: 100%;
		}
		#app .van-field__error-message{
			color: #ee0a24;
		}
	</style>
</head>

<body>
	<div class="sczp xwxq" id="app" v-cloak>
		<div class="public-header-title">
			<div class="public-header-title-content">
				<div class="phtc-return" @click="public_return_page()"></div>
				<div class="phtc-title">上传作品</div>
				
			</div>
		</div>
		<div class="sczp-body xwxq-body">
			<van-form @submit="onSubmit">
				<van-field
				  v-model="worksName"
				  name="作品名称"
				  label="作品名称"
				  placeholder="请填写作品名称"
				  :rules="[{ required: true, message: '作品名称不能为空' }]"
				></van-field>
				<van-field
				  v-model="userName"
				  name="作者姓名"
				  label="作者姓名"
				  placeholder="请填写作者姓名"
				  :rules="[{ required: true, message: '作者姓名不能为空' }]"
				></van-field>
				<van-field
				  v-model="userTel"
				  name="pattern"
				  label="联系电话"
				  placeholder="请填写联系电话"
				  :rules="[{ pattern, message: '联系电话格式不正确' }]"
				></van-field>
				<van-field
				  class="sczp-zpms"
				  v-model="worksDescription"
				  name="作品描述"
				  maxlength="100"
				  label="作品描述"
				  type="textarea"
				  autosize
				  placeholder="请输入作品描述"
				  :rules="[{ required: true, message: '作品描述不能为空' }]"
				></van-field>
				<van-field
				 class="sczp-zpt"
				 name="uploader" label="参赛作品图">
					<template #input>
					  <van-uploader v-model="uploader" :after-read="afterRead" :before-delete="deleteImg" ></van-uploader>
					</template>
				</van-field>
				<div class="sczp-btn-tj-div">
				  <van-button class="sczp-btn-tj" round block type="info" native-type="submit">
					提交
				  </van-button>
				</div>
			</van-form>
			
		</div>
	</div>
	<script>

	</script>
	<script src="js/jquery-2.1.3.min.js"></script>
	<script src="js/public.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/axios.min.js"></script>
	<script src="js/axios_my.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/vant.min.js"></script>

	<script type="text/javascript">
		$(function(){
			navHeader();
			$(window).scroll(function () {
				navHeader();
			})
		})
		var _obj = public_obj();
		 
		var app = new Vue({
			el: '#app',
			data: {
				worksName:'',
				userName: '',
				userTel:'',
				worksDescription:'',
				pattern:/^1(3|4|5|6|7|8|9)\d{9}$/,
				value: 2,
				active: 3,
				show: false,
				// uploader: [{ url: 'https://img.yzcdn.cn/vant/leaf.jpg' }],
				uploader: [],
				data_content:{
					siteId: _obj.idSite_PC,
					channelId: _obj.idTPHD_PC,
					title: "",  // 标题
					body: "", // 描述
					author: "",  //作者
					phoneNumber:'', // 电话号码
					imageUrl:'', //
					pic:'',  // 上传图片后的地址
					imageUrlCount:'', // 图片总数
				},
				imgList:[], // 图片在线地址列表
			},
			created: function () {
				// console.log(1)
				// vant.Toast('提示看看');
				
			},
			mounted: function () {

			},
			methods: {
				onSubmit(values) {
					this.data_content.title = this.worksName;
					this.data_content.body = this.worksDescription;
					this.data_content.author = this.userName;
					this.data_content.phoneNumber = this.userTel;
					this.data_content.imageUrlCount = this.imgList.length;
					// this.data_content.imageUrl = this.uploader[0]
					console.log('submit', values);
					if(this.imgList.length>0){
						this.shangchuan()
					}
					else{
						vant.Toast('请上传图片')
					}
				},
				// 删除图片
				deleteImg(detail,index){
					this.uploader.splice(index.index,1);
					this.imgList.splice(index.index,1);
					console.log('99889',this.imgList)
					// this.fileList.splice(index.index,1);
				},
				// 判断图片类型并上传
				afterRead(file) {
					// 
					if (file.file.type !== "image/jpeg" && file.file.type !== "image/png") {
						this.$toast("请上传 jpg,png 格式图片");
						file.status = 'failed';
						file.message = '上传失败';
						return false;
					}
					// 此时可以自行将文件上传至服务器
					console.log(file);
					this.uploadPic(file)
					console.log('99889',this.uploader)
					
				},
				// 上传图片
				uploadPic(_img){
					var _this = this;
					let formData = new FormData()
					formData.append('imgfile',_img.file)
					axios.post(_obj.shopUrl+'api/services/app/Attachment/UploadImage',
					formData)
					.then(function (response) {
						// _this.pic = response.data;
						_this.imgList.push(response.data.result)
						// console.log('33222222111',_this.pic);
					})
				},
				// 上传作品
				shangchuan(){
					var imgUrl = 'imageUrl'
					for(var i =0;i<this.imgList.length;i++){
						if(i>0){
							imgUrl = imgUrl + i
						}
						this.data_content[imgUrl] = this.imgList[i]
					}
					console.log('11111111112',this.data_content)
					axios.post('api/v1/contents/'+_obj.idSite_PC+'/'+_obj.idTPHD_PC, this.data_content)
					.then(function (response) {
						vant.Toast('上传成功,审核后显示');
						setTimeout(function(){
							public_return_page()
							console.log('去上一页')
						},1000)
					})
				},
				fenxiang() {
					vant.Toast('分享')
				},
				showPopup() {
					this.show = true;
				},
				hidePopup() {
					this.show = false;
				},
				onClickLeft() {
					vant.Toast('返回');
				},
				onClickRight() {
					vant.Toast('按钮');
				},
				selectMulu(_index) {
					this.active = _index;
					vant.Toast(this.active)
					this.hidePopup()
				}
			},

		})
	</script>
</body>

</html>