<!DOCTYPE html>

<html>

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>预约健身房</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!--标准mui.css-->
    <link rel="stylesheet" href="css/mui.min.css">
    <link rel="stylesheet" type="text/css" href="css/mui.picker.min.css" />
    <!--App自定义的css-->
    <link rel="stylesheet" type="text/css" href="css/public.css">
    <link rel="stylesheet" type="text/css" href="css/bodyBuilding.css" />
    <script src="js/public.js" type="text/javascript" charset="utf-8"></script>
  </head>
  <style type="text/css">
    html,
    body {
      background-color: #F5F5F5;
    }
    
    /*.mui-dtpicker-title h5:first-child,
    .mui-dtpicker-title h5:nth-child(2),
    .mui-dtpicker-body .mui-picker:first-child,
    .mui-dtpicker-body .mui-picker:nth-child(2) {
      display: none;
    }
    
    .mui-dtpicker-title h5,
    .mui-dtpicker .mui-picker {
      width: 33.3%;
    }*/
  </style>

  <body>
    <!--
    	作者：648267773@qq.com
    	时间：2019-03-15
    	描述：
    -->
    <div class="body-building-reserve-order public-div">
      <div class="public-header-div">
        <div class="public-header">
          <a class="public-header-return" href="#"></a>
          <h1>预约选择</h1>
        </div>
      </div>
      <button id="toastBtn" type="button" class="mui-btn mui-btn-blue mui-btn-outlined">自动消失提示框</button>
      <div class="bbro-body">
        <table class="bbro-table" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td>预约使用人</td>
            <td>
              <a class="bbro-a" href="#">老虎</a>
            </td>
          </tr>
          <tr>
            <td>开始时间</td>
            <td class="bbro-td-04">20日
              <button data-options="" class="bbro-btn-start " data-h="" data-i="">开始时间</button>
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <div class="bbro-div-one">
                <h3>运动时长</h3>
                <h4><span class="bbro-time-m">30</span>分钟</h4>
              </div>
              <ul class="bbro-ul-time">
                <li class="bbro-li-hover">30</li>
                <li>60</li>
                <li>90</li>
                <li>120</li>
                <li>150</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>结束时间</td>
            <td class="bbro-td-04">
              20日 <span class="bbro-end-time"></span>
              <!--<button data-options="" class="bbro-btn-end ">结束时间</button>-->
            </td>
          </tr>
          <tr>
            <td>运动经费</td>
            <td class="bbro-td-02">&yen;<span>120</span></td>
          </tr>
        </table>
      </div>
    </div>
    <div class="bbro-footer">
      <div class="bbro-ts">错误提示</div>
      <a href="#"><div class="bbro-btn-qdyy">确定预约</div></a>
    </div>
     <script src="js/jquery-1.12.4.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/mui.picker.min.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
      (function($) {
        $.init();
        var btns_bbro_start = $('.bbro-btn-start');
        var btns_bbro_end = $('.bbro-btn-end');
        // 开始时间
        btns_bbro_start.each(function(i, btn) {
          btn.addEventListener('tap', function() {
            var optionsJson = this.getAttribute('data-options') || '{}';
            var options = JSON.parse(optionsJson);
            var id = this.getAttribute('id');
            /*
             * 首次显示时实例化组件
             * 示例为了简洁，将 options 放在了按钮的 dom 上
             * 也可以直接通过代码声明 optinos 用于实例化 DtPicker
             */
            var a = new Date();
            console.log(a.getMinutes())
            var picker = new $.DtPicker({
                        "type": "time",
                        "beginDate": new Date(2016, 04, 20),
                        "endDate": new Date(),
                        // "value": "(a.AddMinutes(10).ToString('yyyy-MM-dd HH:mm'))",
                        "customData": {
                            "i": [{
                                "value": "0",
                                "text": "00"
                            }, {
                                "value": "10",
                                "text": "10"
                            }, {
                                "value": "20",
                                "text": "20"
                            }, {
                                "value": "30",
                                "text": "30"
                            }, {
                                "value": "40",
                                "text": "40"
                            }, {
                                "value": "50",
                                "text": "50"
                            }]
                        }
                    });
            picker.show(function(rs) {
              /*
               * rs.value 拼合后的 value
               * rs.text 拼合后的 text
               * rs.y 年，可以通过 rs.y.vaue 和 rs.y.text 获取值和文本
               * rs.m 月，用法同年
               * rs.d 日，用法同年
               * rs.h 时，用法同年
               * rs.i 分（minutes 的第二个字母），用法同年
               */
              btns_bbro_start[0].innerText = rs.text;
              btns_bbro_start[0].setAttribute('data-h',rs.h.text);
              btns_bbro_start[0].setAttribute('data-i',rs.i.text);
              picker.dispose();
              
              var time_btn_start = jQuery('.bbro-btn-start'); // 开始时间按钮
              var time_end = jQuery('.bbro-end-time');
              // 判断是否已选开始时间
              // 未选
              if(time_btn_start.attr('data-h') == ''){
                time_end.html('');
              }
              //已选
              else{
                var time_end_i = parseInt(time_btn_start.attr('data-i')) + parseInt(jQuery('.bbro-time-m').html());
                var time_end_h = parseInt(time_btn_start.attr('data-h')) + parseInt(time_end_i/60 )
                var time_end_i_0 = time_end_i%60;
                // 加0
                if(time_end_i_0 < 10){
                  time_end_i_0 = '0' + time_end_i_0;
                }
                // 判断小时是否超过24
                if(time_end_h >= 24){
                  time_end_h = '0' + (time_end_h - 24)
                }
                time_end.html(time_end_h + ':' + time_end_i_0)
                console.log(time_end_i,time_end_h)
              }
              
            });
          }, false);
        });
        /*
        // 结束时间
        btns_bbro_end.each(function(i, btn) {
          btn.addEventListener('tap', function() {
            var optionsJson = this.getAttribute('data-options') || '{}';
            var options = JSON.parse(optionsJson);
            var id = this.getAttribute('id');
            var picker = new $.DtPicker({
              "type": "time",
              　　　　"customData": {
                "i": [{
                  "value": "0",
                  "text": "00"
                }, {
                  "value": "10",
                  "text": "10"
                }, {
                  "value": "20",
                  "text": "20"
                }, {
                  "value": "30",
                  "text": "30"
                }, {
                  "value": "40",
                  "text": "40"
                }, {
                  "value": "50",
                  "text": "50"
                }]
              }
            });
            picker.show(function(rs) {
              btns_bbro_end[0].innerText = rs.text;
              picker.dispose();
            });
          }, false);
        });

        */
        document.getElementById("toastBtn").addEventListener('click', function() {
          mui.toast('<div class="bbro-toast">预约成功</div>');
        });


      })(mui);
    </script>

   
    <script type="text/javascript">
      $(function() {
        // 点击选择运动时长
        $('.bbro-ul-time').children('li').on('click', function() {
          var class_click = 'bbro-li-hover',
            this_index = $(this).index(),
            e_num = $('.bbro-time-m'); // 运动时长
         
          $(this).addClass(class_click).siblings().removeClass(class_click);
          // 循环为前面的元素添加class
          for(var i = 0; i < this_index; i++) {
            $(this).parent().children('li').eq(i).addClass(class_click)
          }
          e_num.html($(this).html())
          
          
          
          var time_btn_start = jQuery('.bbro-btn-start'); // 开始时间按钮
          var time_end = jQuery('.bbro-end-time');
          // 判断是否已选开始时间
          // 未选
          if(time_btn_start.attr('data-h') == ''){
            time_end.html('');
          }
          //已选
          else{
            var time_end_i = parseInt(time_btn_start.attr('data-i')) + parseInt(jQuery('.bbro-time-m').html());
            var time_end_h = parseInt(time_btn_start.attr('data-h')) + parseInt(time_end_i/60 )
            var time_end_i_0 = time_end_i%60;
            // 加0
            if(time_end_i_0 < 10){
              time_end_i_0 = '0' + time_end_i_0;
            }
            // 判断小时是否超过24
            if(time_end_h >= 24){
              time_end_h = '0' + (time_end_h - 24)
            }
            time_end.html(time_end_h + ':' + time_end_i_0)
            console.log(time_end_i,time_end_h)
          }
        })
        
        // 点击确定预约
        $('.bbro-btn-qdyy').on('click',function(){
          $('#toastBtn').click()
        })
      })
    </script>

  </body>

</html>