<!DOCTYPE html>
<html>

  <head lang="en">
    <meta charset="UTF-8">
    <!-- 使用最新的ie内核渲染 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 国产浏览器(360)使用webkit内核 -->
    <meta name="renderer" content="webkit">
    <!-- 禁止识别为手机号码 -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link href="css/bootstrap.min.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/publicDefault.css" />
    <link rel="stylesheet" type="text/css" href="css/studentStudy.css" />
    <title>在线考试</title>
    <style type="text/css">

    </style>
  </head>

  <body>
    <div class="student-test">
      <!-- 顶部 -->
      <div class="ss-header">
        <!-- 调用公用头部 -->
        <div class="ss-header-top"></div>
        <div class="cs-header-img"></div>
      </div>
      <!-- 主要内容 -->
      <div class="st-body">
        <div class="ssb-nav">
          <a href="index.html">平台首页</a>/<a href="centerStudents.html">在线课堂</a>/<a href="studentStudy.html">课程学习</a>/<a class="ssb-nav-hover" href="#">在线考试</a>
        </div>
        <!-- .stbc-test-list-a:定位元素 -->
        <!-- .stbc-test-list-one:为stbc-test-list添加表示单选 
              .stbc-test-list-two:为stbc-test-list添加表示多选
              answer="null":为stbc-test-list的选中答案
        -->
        <div class="stb-content">
          <div class="stb-content-test">
            <!-- 单选题 -->
            <h1>单选题（共30题 每题5分）</h1>
            <div class="stbc-test-list-one-father">
              <div class="stbc-test-list stbc-test-list-one" answer="">
                <span class="stbc-test-list-number">编号</span>
                <h2>在中国历史上，有哪些发育有利于进步</h2>
                <ul>
                  <li class="info-list-btn-div" answernum="a"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="b"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="c"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="d"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                </ul>
              </div>
              <div class="stbc-test-list stbc-test-list-one" answer="">
                <span class="stbc-test-list-number">编号</span>
                <h2>在中国历史上，有哪些发育有利于进步</h2>
                <ul>
                  <li class="info-list-btn-div" answernum="a"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="b"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="c"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="d"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                </ul>
              </div>
              <div class="stbc-test-list stbc-test-list-one" answer="">
                <span class="stbc-test-list-number">编号</span>
                <h2>在中国历史上，有哪些发育有利于进步</h2>
                <ul>
                  <li class="info-list-btn-div" answernum="a"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="b"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="c"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="d"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                </ul>
              </div>
              <div class="stbc-test-list stbc-test-list-one" answer="">
                <span class="stbc-test-list-number">编号</span>
                <h2>在中国历史上，有哪些发育有利于进步</h2>
                <ul>
                  <li class="info-list-btn-div" answernum="a"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="b"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="c"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="d"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                </ul>
              </div>
            </div>
            <!-- 多选题 -->
            <h1>多选题（共30题 每题5分）</h1>
            <div class="stbc-test-list-two-father">
              <div class="stbc-test-list stbc-test-list-two" answer="">
                <span class="stbc-test-list-number">编号</span>
                <h2>在中国历史上，有哪些发育有利于进步</h2>
                <ul>
                  <li class="info-list-btn-div" answernum="a"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="b"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="c"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="d"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                </ul>
              </div>
              <div class="stbc-test-list stbc-test-list-two" answer="">
                <span class="stbc-test-list-number">编号</span>
                <h2>在中国历史上，有哪些发育有利于进步</h2>
                <ul>
                  <li class="info-list-btn-div" answernum="a"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="b"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="c"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="d"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                </ul>
              </div>
              <div class="stbc-test-list stbc-test-list-two" answer="">
                <span class="stbc-test-list-number">编号</span>
                <h2>在中国历史上，有哪些发育有利于进步</h2>
                <ul>
                  <li class="info-list-btn-div" answernum="a"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="b"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="c"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                  <li class="info-list-btn-div" answernum="d"><input class="info-list-btn" type="checkbox" /><span>论毛泽东，邓小平味道领袖的功绩</span></li>
                </ul>
              </div>

            </div>
          </div>
          <!-- 答题卡 -->
          <div class="stb-content-answer-div">
            <div class="stb-content-answer-header">
              <h1>答题卡</h1>
              <h2 id="countdown">倒计时</h2>
            </div>
            <!-- .stbc-answer-btn-hover：表示完成的答题卡 -->
            <div class="stbc-answer-one-div">
              <h3>单选题(共30题，每题5分)</h3>
              <div class="stbc-answer-one">
                <!-- <a href="#"><button class="stbc-answer-btn">1</button></a> -->
              </div>
            </div>
            <div class="stbc-answer-two-div">
              <h3>多选题(共30题，每题5分)</h3>
              <div class="stbc-answer-two"></div>
            </div>
            <button class="stbc-answer-btn-submit">交卷</button>
          </div>
        </div>
      </div>

      <!-- public-footer -->
      <div class="index-footer"></div>
      <!-- 公用二维码 -->
      <div class="index-gzh"></div>
    </div>
    <script src="js/jquery-2.1.3.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/countdown.js"></script>
    <script src="js/public.js"></script>
    <script type="text/javascript">
      $(function(){
        // 调用公用底部
        publicFooter('.index-footer')
        // 调用公用二维码
        publicEWM('.index-gzh')
        // 加载公用头部
        publicHeader('.ss-header-top')
        
        $('#countdown').countdown({
          //活动开始时间 (可采用时间戳 或者 标准日期时间格式 "yyyy/MM/dd HH:mm:ss")
          //优先采取元素的data-stime值(该值只能为时间戳格式)
          startTime: '2018/11/7 16:45:00',//考试结束时间 (可采用时间戳 或者 标准日期时间格式 "yyyy/MM/dd HH:mm:ss")
          //优先采取元素的data-etime值(该值只能为时间戳格式)         
          endTime: '2017/9/10 24:00:00',
          //活动开始前倒计时的修饰        
          beforeStart: '',
          //活动进行中倒计时的修饰 
          beforeEnd: '',
          //活动结束后的修饰          
          afterEnd: '考试结束了,答案已提交，时间自己设置',
          //时间格式化(可采用"ddd:hh:mm:ss、 dd:hh:mm:ss、  hh:mm:ss、 mm:ss、 ss"等)                   
          format: 'hh:mm:ss',
          //活动结束后的回调函数                    
          callback: function () {
            // 提交答案
            submitResult()
            console.log('考试结束啦，正在提交答案');
          }
        });

        var classHover = 'info-list-div-hover', // .info-list-btn-div添加表示打钩
          classFatherDiv = 'stbc-test-list', // 祖父元素
          classFatherDivOne = 'stbc-test-list-one', // 单选祖父元素
          classFatherDivTwo = 'stbc-test-list-two', // 多选祖父元素
          classFatherAnwerOne = 'stbc-answer-one', // 答题卡单选祖父元素
          classFatherAnwerTwo = 'stbc-answer-two', // 答题卡多选祖父元素
          classAnwerBtnOk = 'stbc-answer-btn-hover', // 完成的答题卡按钮
          classAnwerBtn = 'stbc-answer-btn'; // 答题卡按钮


        // 点击div选中input
        $('.info-list-btn-div').on('click', function () {
          var thisIndexFather = $(this).parents(classFatherDiv).index();  // 祖父元素index
          var answerNumFather = $(this).parents('.' + classFatherDiv).attr('answer'); // 答案
          var answerNum = $(this).attr('answernum');

          // 单选
          if($(this).parents('.' + classFatherDiv).hasClass(classFatherDivOne)){
            // 点击取消选中
            if ($(this).hasClass(classHover)) {
              $(this).removeClass(classHover).children("input").removeAttr("checked");
              // 取消答案
              $(this).parents('.' + classFatherDiv).attr('answer', '');
              // $(this).parents('.' + classFatherDiv).attr('answer', answerFather.replace(answerNum))
            }
            // 点击选中
            else {
              $(this).addClass(classHover).children("input").prop("checked", "checked");
              // 添加答案
              $(this).parents('.' + classFatherDiv).attr('answer', answerNum)
              // 取消兄弟元素的选中状态
              $(this).siblings('li').each(function(){
                $(this).removeClass(classHover).children("input").removeAttr("checked");
              })
            }
          }
          // 多选
          else if($(this).parents('.' + classFatherDiv).hasClass(classFatherDivTwo)) {
            // 点击取消选中
            if ($(this).hasClass(classHover)) {
              $(this).removeClass(classHover).children("input").removeAttr("checked");
              // 取消答案
              $(this).parents('.' + classFatherDiv).attr('answer', answerNumFather.replace(answerNum,''))
            }
            // 点击选中
            else {
              $(this).addClass(classHover).children("input").prop("checked", "checked");
              // 添加答案
              $(this).parents('.' + classFatherDiv).attr('answer', answerNumFather + answerNum)
            }
          }
          else{
            alert('数据出错，既不是单选也不是多选')
          }
          // 调用答题检测
          answerSubmit()
        })

        // 页面加载时生成答题卡和题目对应id
        $('.stbc-test-list').each(function(){
          // id格式 test-one-1,test-one-2;test-two-1,test-two-2
          var idNameOne = 'test-one-',
              idNameTwo = 'test-two-',
              thisIndex = $(this).index() + 1 ;
          // 给题目添加序号
          $(this).children('.stbc-test-list-number').html(thisIndex);
          // 生成单选答题卡
          if ($(this).hasClass(classFatherDivOne)) {
            var answerBtn = $('<a href="#' + idNameOne + thisIndex +'"><button class="stbc-answer-btn">' + thisIndex + '</button></a>')
            $(this).attr('id',idNameOne + thisIndex)
            $('.' + classFatherAnwerOne).append(answerBtn)
          }
          // 生成多选答题卡
          else if ($(this).hasClass(classFatherDivTwo)) {
            var answerBtn = $('<a href="#' + idNameTwo + thisIndex + '"><button class="stbc-answer-btn">' + thisIndex + '</button></a>')
            $(this).attr('id', idNameTwo + thisIndex)
            $('.' + classFatherAnwerTwo).append(answerBtn)
          }
          else {
            alert('答题卡生成错误')
          }
        })

        // 点击交卷
        $('.stbc-answer-btn-submit').on('click',function(){
          // 判断是否完成答题
          // 未完成答题
          if ($('.' + classAnwerBtn).length != $('.' + classAnwerBtnOk).length ) {
            // 遍历答题卡按钮
            $('.' + classAnwerBtn).each(function () {
              // 未完成答题
              if (!$(this).hasClass(classAnwerBtnOk)) {
                $(this).click()
              }
            })
            alert('答题未完成')
          }
          // 完成答题
          else {
            // 调用提交答案
            submitResult()
            alert('答题完成，正在提交答案，请稍后')
          }
        })
        // 提交答案
        function submitResult(){
          var one = [],
              two = [];
          $('.' + classFatherDiv ).each(function(){
            if($(this).hasClass(classFatherDivOne)){
              one.push($(this).attr('answer'))
            }
            else if($(this).hasClass(classFatherDivTwo)){
              two.push($(this).attr('answer'))
            }
            else {
              alert('答案传输错误，请刷新页面')
            }
              
          })
          console.log('单选答案为: '+ one , '多选答案为' + two)
        }

        // 答题检测
        function answerSubmit() {
          // 先移除所有的答题卡，再添加。
          $('.' + classAnwerBtn).removeClass(classAnwerBtnOk)
          // 遍历输入框
          $('.' + classHover).each(function () {
            var fatherIndex = $(this).parents('.' + classFatherDiv).index();
            // 对应单选答题卡选择
            if ($(this).parents('.' + classFatherDiv).hasClass(classFatherDivOne)) {
              //
              $('.'+ classFatherAnwerOne).children('a').eq(fatherIndex).children('button').addClass(classAnwerBtnOk)
            }
            // 对应多选答题卡选择
            else if ($(this).parents('.' + classFatherDiv).hasClass(classFatherDivTwo)) {
              $('.' + classFatherAnwerTwo).children('a').eq(fatherIndex).children('button').addClass(classAnwerBtnOk)
            }
          })
        }
        /*
        // 刷新页面时，更新选中状态--学员信息管理和在线考试
        function shuaxin(){
          $('.info-list-btn').each(function () {
            // 选中则为父元素添加选中状态
            if ($(this).is(':checked')) {
              $(this).parents('.info-list-btn-div').addClass(classHover);
            }
          })
        }
        // 刷新页面时，更新选中状态
        shuaxin();
        */

        // 刷新页面时，清空
        $("input").removeAttr("checked");
        // 刷新页面时，调动答题检测
        answerSubmit();
      })
    </script>  
  </body>

</html>